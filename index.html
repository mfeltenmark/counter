<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Resa - DagrÃ¤knare</title>

    <!-- OBS: absolut path, som nÃ¤r det funkade tidigare -->
    <link rel="manifest" href="/counter/manifest.json">

    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 25%, #FFD700 50%, #9ACD32 75%, #4CAF50 100%);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .celebration-bounce {
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .glow-card {
            box-shadow: 0 10px 40px rgba(255, 107, 53, 0.2);
            transition: all 0.3s ease;
        }

        .glow-card:hover {
            box-shadow: 0 15px 50px rgba(255, 107, 53, 0.3);
            transform: translateY(-5px);
        }

        .milestone-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .progress-bar {
            transition: width 0.6s ease;
        }

        .sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Main container -->
    <div class="min-h-screen flex items-center justify-center px-4 sm:px-6 lg:px-8 py-12">
        <div class="max-w-4xl w-full">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-5xl md:text-6xl font-bold text-white mb-3 drop-shadow-lg">
                    âœ¨ My Journey âœ¨
                </h1>
                <p class="text-xl md:text-2xl text-white/90 font-light">
                    Every day is a victory
                </p>
            </div>

            <!-- Result Section -->
            <div class="result-section mb-6" id="result-section">
                <!-- Main Counter -->
                <div class="bg-white rounded-3xl p-10 mb-6 glow-card text-center">
                    <div class="mb-4">
                        <div class="text-8xl md:text-9xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-green-500 celebration-bounce" id="days-count">0</div>
                        <div class="text-3xl md:text-4xl font-semibold text-gray-700 mt-2">days strong! ğŸ’ª</div>
                    </div>

                    <!-- Encouraging Message -->
                    <div class="mt-6 p-4 bg-gradient-to-r from-orange-50 to-green-50 rounded-2xl">
                        <p class="text-xl font-semibold text-gray-800" id="encouragement-text">Amazing work!</p>
                    </div>
                </div>

                <!-- Milestone Progress -->
                <div class="bg-white rounded-3xl p-6 mb-6 glow-card" id="milestone-section">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ Next Milestone</h3>
                    <div class="mb-2 flex justify-between text-sm font-semibold text-gray-600">
                        <span>From <span id="current-milestone">0 days</span></span>
                        <span>To <span id="next-milestone">7 days</span></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="progress-bar bg-gradient-to-r from-orange-500 to-green-500 h-4 rounded-full" id="progress-bar" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 text-center" id="progress-text">0 days left!</p>
                </div>

                <!-- Achieved Milestones -->
                <div class="bg-white rounded-3xl p-6 mb-6 glow-card hidden" id="milestones-achieved">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ† Achievements Unlocked</h3>
                    <div class="flex flex-wrap gap-3" id="milestone-badges"></div>
                </div>

                <!-- Date Info -->
                <div class="bg-white/90 rounded-2xl p-6 mb-6">
                    <div class="grid md:grid-cols-2 gap-4 text-gray-700">
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">ğŸš€</span>
                            <div>
                                <div class="text-sm font-medium text-gray-500">Start Date</div>
                                <div class="font-semibold" id="from-date">-</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">ğŸ“…</span>
                            <div>
                                <div class="text-sm font-medium text-gray-500">Today</div>
                                <div class="font-semibold" id="to-date">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Section (hidden by default) -->
            <div id="input-section" class="bg-white rounded-3xl p-8 mb-6 glow-card hidden">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">
                        â• Create New Counter
                    </h2>
                    <button
                        id="close-form-btn"
                        class="text-gray-400 hover:text-gray-600 text-3xl font-bold leading-none"
                        title="Close"
                    >
                        Ã—
                    </button>
                </div>
                <p class="text-sm text-gray-600 mb-4">
                    You can have multiple counters. If you have a setback, just start a new one - your history is preserved! ğŸ’ª
                </p>
                <label for="counter-name" class="block text-sm font-semibold mb-2 text-gray-700">
                    ğŸ“ Counter Name (optional)
                </label>
                <input
                    type="text"
                    id="counter-name"
                    placeholder="e.g. 'My Journey 2024' or 'Attempt 2'"
                    class="w-full bg-gray-50 border-2 border-gray-200 rounded-xl px-4 py-3 mb-4 focus:outline-none focus:border-orange-400 transition-colors text-gray-800"
                >
                <label for="start-date" class="block text-sm font-semibold mb-2 text-gray-700">
                    ğŸ“… Start Date
                </label>
                <input
                    type="date"
                    id="start-date"
                    required
                    class="w-full bg-gray-50 border-2 border-gray-200 rounded-xl px-4 py-3 mb-6 focus:outline-none focus:border-orange-400 transition-colors text-gray-800 text-lg"
                >
                <button
                    id="calculate-btn"
                    class="w-full bg-gradient-to-r from-orange-500 to-green-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl hover:scale-105 transition-all"
                >
                    ğŸ¯ Create Counter
                </button>
            </div>

            <!-- Saved Counters -->
            <div class="saved-counters mt-8" id="saved-counters">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white drop-shadow-lg">
                        ğŸ’« My Counters
                    </h2>
                    <button
                        id="toggle-form-btn"
                        class="bg-white/90 hover:bg-white text-orange-600 font-bold text-2xl w-12 h-12 rounded-full shadow-lg hover:shadow-xl hover:scale-110 transition-all flex items-center justify-center"
                        title="Create new counter"
                    >
                        +
                    </button>
                </div>
                <div id="counters-list" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const startDateInput = document.getElementById('start-date');
        const counterNameInput = document.getElementById('counter-name');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultSection = document.getElementById('result-section');
        const daysCount = document.getElementById('days-count');
        const fromDate = document.getElementById('from-date');
        const toDate = document.getElementById('to-date');
        const countersList = document.getElementById('counters-list');
        const encouragementText = document.getElementById('encouragement-text');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const currentMilestone = document.getElementById('current-milestone');
        const nextMilestoneEl = document.getElementById('next-milestone');
        const milestonesAchieved = document.getElementById('milestones-achieved');
        const milestoneBadges = document.getElementById('milestone-badges');
        const inputSection = document.getElementById('input-section');
        const toggleFormBtn = document.getElementById('toggle-form-btn');
        const closeFormBtn = document.getElementById('close-form-btn');

        // Milestones (in days)
        const milestones = [
            1, 7, 14, 21, 28, 35, 42, 49, 56,
            60, 75, 90, 120, 150, 180, 240,
            300, 365, 456, 548, 730, 1095
        ];

        const milestoneNames = {
            1: 'ğŸŒŸ First Day',
            7: 'ğŸ“… 1 Week',
            14: 'ğŸ¯ 2 Weeks',
            21: 'ğŸ’« 3 Weeks',
            28: 'ğŸŒ¸ 4 Weeks',
            35: 'âœ¨ 5 Weeks',
            42: 'ğŸ¨ 6 Weeks',
            49: 'ğŸš€ 7 Weeks',
            56: 'ğŸŒº 8 Weeks',
            60: 'ğŸ’ 2 Months',
            75: 'ğŸŒŸ 2.5 Months',
            90: 'ğŸ‘‘ 3 Months',
            120: 'ğŸ… 4 Months',
            150: 'ğŸ’ª 5 Months',
            180: 'ğŸŒˆ 6 Months',
            240: 'ğŸ¯ 8 Months',
            300: 'â­ 10 Months',
            365: 'ğŸŠ 1 Year',
            456: 'ğŸ”¥ 15 Months',
            548: 'ğŸ’« 18 Months',
            730: 'ğŸ‘‘ 2 Years',
            1095: 'â­ 3 Years'
        };

        function getEncouragingMessage(days) {
            if (days === 0) return 'Your journey begins today! ğŸš€';
            if (days === 1) return 'First day complete! You are a star! ğŸŒŸ';
            if (days < 7) return `${days} days! Every day is a victory! ğŸ’ª`;
            if (days === 7) return 'A whole week! Incredibly strong work! ğŸ‰';
            if (days < 14) return `${days} days of strength and determination! ğŸ’«`;
            if (days === 14) return 'Two weeks! Your willpower is inspiring! ğŸŒŸ';
            if (days < 30) return `${days} amazing days! Keep shining! âœ¨`;
            if (days === 30) return 'A whole month! You are unstoppable! ğŸ†';
            if (days < 60) return `${days} days of courage and strength! So proud! ğŸ’`;
            if (days === 60) return 'Two months! Your journey is mighty! ğŸ‘‘';
            if (days < 90) return `${days} days! Your power is incredible! ğŸ”¥`;
            if (days === 90) return 'Three months! A true hero! ğŸ¦¸';
            if (days < 180) return `${days} days of pure will and strength! ğŸŒˆ`;
            if (days === 180) return 'Half a year! Fantastically done! ğŸŠ';
            if (days < 365) return `${days} days! Your journey inspires! â­`;
            if (days === 365) return 'ONE YEAR! Absolutely incredible! ğŸ†ğŸ‰ğŸ†';
            if (days < 730) return `${days} days of strength! Legend! ğŸ‘‘`;
            if (days === 730) return 'TWO YEARS! Unshakeable! ğŸ”¥â­';
            return `${days} amazing days! You are an inspiration! ğŸŒŸ`;
        }


        // Confetti (med guard offline)
        function fireConfetti() {
            if (typeof confetti !== "function") return;

            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);

                const particleCount = 50 * (timeLeft / duration);

                confetti({
                    ...defaults,
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: ['#FF6B35', '#FFA500', '#FFD700', '#9ACD32', '#4CAF50']
                });
                confetti({
                    ...defaults,
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: ['#FF6B35', '#FFA500', '#FFD700', '#9ACD32', '#4CAF50']
                });
            }, 250);
        }

        function getNextMilestone(days) {
            for (let milestone of milestones) {
                if (days < milestone) return milestone;
            }
            return null;
        }

        function getAchievedMilestones(days) {
            return milestones.filter(m => days >= m);
        }

        function updateMilestoneProgress(days) {
            const achieved = getAchievedMilestones(days);
            const next = getNextMilestone(days);

            if (achieved.length > 0) {
                milestonesAchieved.classList.remove('hidden');
                milestoneBadges.innerHTML = achieved.map(m => `
                    <div class="milestone-badge px-4 py-2 rounded-full text-white font-bold text-sm sparkle">
                        ${milestoneNames[m] || m + ' days'}
                    </div>
                `).join('');
            }

            if (next) {
                const previous = achieved.length > 0 ? achieved[achieved.length - 1] : 0;
                const progress = ((days - previous) / (next - previous)) * 100;
                const daysLeft = next - days;

                currentMilestone.textContent = milestoneNames[previous] || previous + ' days';
                nextMilestoneEl.textContent = milestoneNames[next] || next + ' days';
                progressBar.style.width = progress + '%';
                progressText.textContent = `${daysLeft} day${daysLeft !== 1 ? 's' : ''} left to ${milestoneNames[next]}!`;
            } else {
                const previous = achieved[achieved.length - 1];
                currentMilestone.textContent = milestoneNames[previous] || previous + ' days';
                nextMilestoneEl.textContent = 'âˆ';
                progressBar.style.width = '100%';
                progressText.textContent = 'All milestones achieved! You are a legend! ğŸ‘‘';
            }
        }

        let savedCounters = JSON.parse(localStorage.getItem('counters') || '[]');
        const today = new Date().toISOString().split('T')[0];
        startDateInput.value = today;
        const lastUsedDate = localStorage.getItem('lastUsedDate');

        function calculateDays(startDate, endDate = new Date()) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('sv-SE', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function displayResult(startDate, showConfetti = true) {
            const days = calculateDays(startDate);
            const todayDate = new Date();

            daysCount.textContent = days;
            fromDate.textContent = formatDate(startDate);
            toDate.textContent = formatDate(todayDate.toISOString().split('T')[0]);

            encouragementText.textContent = getEncouragingMessage(days);
            updateMilestoneProgress(days);

            resultSection.classList.remove('hidden');
            localStorage.setItem('lastUsedDate', startDate);

            if (showConfetti && milestones.includes(days)) {
                fireConfetti();
            }

            if (showConfetti) {
                resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function saveCounter(startDate, customName = '') {
            const counterExists = savedCounters.some(counter => counter.date === startDate);
            if (!counterExists) {
                const counterName = customName.trim() || `My journey from ${formatDate(startDate)}`;
                savedCounters.push({
                    id: Date.now(),
                    date: startDate,
                    name: counterName
                });
                localStorage.setItem('counters', JSON.stringify(savedCounters));
                renderSavedCounters();
            }
        }

        function deleteCounter(id) {
            const deletedCounter = savedCounters.find(counter => counter.id === id);
            savedCounters = savedCounters.filter(counter => counter.id !== id);
            localStorage.setItem('counters', JSON.stringify(savedCounters));

            const currentLastUsedDate = localStorage.getItem('lastUsedDate');
            if (deletedCounter && deletedCounter.date === currentLastUsedDate) {
                if (savedCounters.length > 0) {
                    displayResult(savedCounters[0].date, false);
                } else {
                    resultSection.classList.add('hidden');
                    localStorage.removeItem('lastUsedDate');
                }
            }

            renderSavedCounters();
        }

        function renderSavedCounters() {
            if (savedCounters.length === 0) {
                countersList.innerHTML = '<p class="text-white/80 text-center text-lg">No saved counters yet</p>';
                return;
            }

            countersList.innerHTML = savedCounters.map(counter => {
                const days = calculateDays(counter.date);
                const achieved = getAchievedMilestones(days);
                const topBadge = achieved.length > 0 ? achieved[achieved.length - 1] : null;

                return `
                    <div class="bg-white rounded-2xl p-6 glow-card">
                        <div class="flex justify-between items-start gap-4">
                            <div class="flex-1 cursor-pointer" onclick="displayResult('${counter.date}', false); document.getElementById('result-section').scrollIntoView({ behavior: 'smooth', block: 'start' });">
                                <div class="text-lg font-semibold text-gray-800 mb-2">
                                    ${counter.name}
                                </div>
                                <div class="text-5xl font-bold mb-3">
                                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-green-500">
                                        ${days}
                                    </span>
                                    <span class="text-gray-600 text-2xl ml-2">days</span>
                                </div>
                                ${topBadge ? `
                                    <div class="inline-block milestone-badge px-3 py-1 rounded-full text-white font-semibold text-xs mb-2">
                                        ${milestoneNames[topBadge]}
                                    </div>
                                ` : ''}
                                <div class="text-sm text-gray-500">
                                    Since: ${formatDate(counter.date)}
                                </div>
                                <div class="text-xs text-orange-600 font-semibold mt-2">
                                    ğŸ‘† Click for details
                                </div>
                            </div>
                            <button
                                class="bg-gradient-to-r from-red-400 to-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:scale-105 transition-transform text-sm"
                                onclick="deleteCounter(${counter.id})"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        toggleFormBtn.addEventListener('click', () => {
            inputSection.classList.remove('hidden');
            inputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        closeFormBtn.addEventListener('click', () => {
            inputSection.classList.add('hidden');
        });

        calculateBtn.addEventListener('click', () => {
            const selectedDate = startDateInput.value;
            const customName = counterNameInput.value;

            if (!selectedDate) {
                alert('Please select a date');
                return;
            }

            displayResult(selectedDate);
            saveCounter(selectedDate, customName);

            counterNameInput.value = '';
            startDateInput.value = new Date().toISOString().split('T')[0];

            inputSection.classList.add('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        startDateInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculateBtn.click();
            }
        });

        renderSavedCounters();

        if (lastUsedDate) {
            const counterExists = savedCounters.some(counter => counter.date === lastUsedDate);
            if (counterExists) {
                displayResult(lastUsedDate, false);
            } else if (savedCounters.length > 0) {
                displayResult(savedCounters[0].date, false);
            }
        } else if (savedCounters.length > 0) {
            displayResult(savedCounters[0].date, false);
        }

        setInterval(() => {
            renderSavedCounters();
        }, 60000);
    </script>

    <!-- Enkel SW-registrering, som nÃ¤r det funkade -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("./service-worker.js")
            .catch(err => console.log("SW registration failed:", err));
        });
      }
    </script>
</body>
</html>
